<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <title>–ö–æ–º–µ—Ä—Ü—ñ–π–Ω–∞ –ü—Ä–æ–ø–æ–∑–∏—Ü—ñ—è - General Machines</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞ –ø–∞–ª—ñ—Ç—Ä–∞ */
            --bg-body: #F5F7FA;
            --bg-paper: #FFFFFF;
            --text-main: #1A1A1A;
            --text-secondary: #6B7280;
            --accent: #F4C430; /* –ñ–æ–≤—Ç–∏–π General Machines */
            --border: #E5E7EB;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 40px 20px;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        .generator {
            max-width: 1100px;
            margin: 0 auto 20px auto;
            background: var(--bg-paper);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        .generator h2 {
            margin: 0 0 12px 0;
            font-size: 16px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .generator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px 16px;
            align-items: end;
        }

        .field label {
            display: block;
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.7px;
        }

        .field input,
        .field select {
            width: 100%;
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 10px 12px;
            font-size: 14px;
            font-family: inherit;
            background: #fff;
            color: var(--text-main);
            outline: none;
        }

        .field input:focus,
        .field select:focus {
            border-color: rgba(244, 196, 48, 0.7);
            box-shadow: 0 0 0 3px rgba(244, 196, 48, 0.18);
        }

        .actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            align-items: center;
        }

        .btn {
            appearance: none;
            border: 1px solid var(--border);
            background: #fff;
            color: var(--text-main);
            border-radius: 10px;
            padding: 10px 12px;
            font-weight: 700;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            transition: transform 0.12s ease, box-shadow 0.12s ease;
        }

        .btn-primary {
            background: var(--accent);
            border-color: var(--accent);
        }

        .btn:active {
            transform: translateY(1px);
        }

        .hint {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 6px;
        }

        .hidden {
            display: none !important;
        }

        .page {
            max-width: 210mm; /* –§–æ—Ä–º–∞—Ç –ê4 */
            margin: 0 auto;
            background: var(--bg-paper);
            padding: 60px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            position: relative;
        }

        /* HEADER */
        header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 60px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 30px;
        }

        .brand {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .logo-placeholder {
            /* –°—Ç–∏–ª—ñ –¥–ª—è –ª–æ–≥–æ—Ç–∏–ø—É */
            max-width: 200px;
            height: auto;
            display: block;
        }

        .company-details {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 10px;
        }

        .meta-info {
            text-align: right;
        }

        .date {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* HERO SECTION */
        .hero {
            margin-bottom: 50px;
        }

        .client-name {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            display: block;
        }

        h1 {
            font-size: 32px;
            font-weight: 800;
            line-height: 1.2;
            margin: 0 0 15px 0;
            text-transform: uppercase;
        }

        .highlight {
            position: relative;
            z-index: 1;
        }
        
        .highlight::after {
            content: '';
            position: absolute;
            bottom: 2px;
            left: -2px;
            right: -2px;
            height: 12px;
            background: var(--accent);
            opacity: 0.4;
            z-index: -1;
        }

        .sub-hero {
            font-size: 18px;
            color: var(--text-secondary);
            max-width: 80%;
        }

        /* GRID SECTIONS */
        .section-title {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--text-secondary);
            margin-bottom: 25px;
            border-left: 3px solid var(--accent);
            padding-left: 10px;
        }

        .features-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 60px;
        }

        .feature-item h3 {
            font-size: 16px;
            font-weight: 600;
            margin: 0 0 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feature-item p {
            font-size: 14px;
            color: var(--text-secondary);
            margin: 0;
        }

        /* TECH SPECS WITH IMAGE */
        .specs-layout {
            display: flex;
            gap: 40px;
            margin-bottom: 60px;
            align-items: start;
        }

        .specs-content {
            flex: 1;
        }

        .specs-image {
            flex: 1;
            background: #f0f0f0;
            height: 300px; /* –í–∏—Å–æ—Ç–∞ –ø—ñ–¥ —Ñ–æ—Ç–æ */
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .specs-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        ul.minimal-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        ul.minimal-list li {
            position: relative;
            padding-left: 20px;
            margin-bottom: 12px;
            font-size: 14px;
        }

        ul.minimal-list li::before {
            content: '';
            position: absolute;
            left: 0;
            top: 8px;
            width: 6px;
            height: 6px;
            background: var(--accent);
            border-radius: 50%;
        }

        /* PRICING */
        .pricing-section {
            background: #FAFAFA;
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid var(--border);
        }

        .product-name {
            font-size: 18px;
            font-weight: 600;
        }

        .price-block {
            text-align: right;
        }

        .price-label {
            font-size: 12px;
            color: var(--text-secondary);
            display: block;
        }

        .price-value {
            font-size: 24px;
            font-weight: 800;
            color: var(--text-main);
        }

        /* TERMS FOOTER */
        .terms-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            border-top: 1px solid var(--border);
            padding-top: 30px;
            margin-bottom: 40px;
        }

        .term-item strong {
            display: block;
            font-size: 12px;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .term-item span {
            font-size: 14px;
            font-weight: 600;
        }

        /* FOOTER */
        footer {
            text-align: center;
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 60px;
        }

        footer a {
            color: var(--text-main);
            text-decoration: none;
            font-weight: 600;
        }

        /* PRINT SETTINGS */
        @media print {
            body { padding: 0; background: #fff; }
            .page { box-shadow: none; padding: 40px; max-width: 100%; }
            .generator { display: none !important; }
        }

        @media (max-width: 768px) {
            .page { padding: 20px; }
            body { padding: 20px 12px; }
            .generator { padding: 14px; }
            .generator-grid { grid-template-columns: 1fr; }
            header, .features-grid, .specs-layout, .pricing-section, .terms-grid {
                flex-direction: column;
                grid-template-columns: 1fr;
                text-align: left;
                align-items: flex-start;
            }
            .meta-info { text-align: left; margin-top: 20px; }
            .price-block { text-align: left; margin-top: 15px; }
        }
    </style>
</head>
<body>

<div class="generator" id="generator">
    <h2>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–º–µ—Ä—Ü—ñ–π–Ω–æ—ó –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—ó</h2>
    <div class="generator-grid">
        <div class="field">
            <label for="clientFullName">–ü–Ü–ë (–¥–ª—è –∫–æ–≥–æ –ö–ü)</label>
            <input id="clientFullName" type="text" placeholder="–ù–∞–ø—Ä.: –û–ª–µ–≥ –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á" autocomplete="name">
        </div>

        <div class="field">
            <label for="clientTractor">–¢—Ä–∞–∫—Ç–æ—Ä –∫–ª—ñ—î–Ω—Ç–∞</label>
            <input id="clientTractor" type="text" placeholder="–ù–∞–ø—Ä.: –ú–¢–ó 1025" autocomplete="off">
        </div>

        <div class="field">
            <label for="productSelect">–ê–≥—Ä–µ–≥–∞—Ç (–∑—ñ —Å–ø–∏—Å–∫—É)</label>
            <select id="productSelect">
                <option value="">–û–±–µ—Ä—ñ—Ç—å –∞–≥—Ä–µ–≥–∞—Ç‚Ä¶</option>
            </select>
            <div class="hint">–ü—ñ—Å–ª—è –≤–∏–±–æ—Ä—É –º–æ–∂–Ω–∞ –≤—ñ–¥—Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ –Ω–∞–∑–≤—É —Ç–∞ —Ü—ñ–Ω—É.</div>
        </div>

        <div class="field">
            <label for="productName">–ù–∞–∑–≤–∞ –∞–≥—Ä–µ–≥–∞—Ç—É (—Ä–µ–¥–∞–≥—É—î—Ç—å—Å—è)</label>
            <input id="productName" type="text" placeholder="–ù–∞–∑–≤–∞ –∞–≥—Ä–µ–≥–∞—Ç—É">
        </div>

        <div class="field">
            <label for="priceVat">–¶—ñ–Ω–∞ –∑ –ü–î–í (–≥—Ä–Ω)</label>
            <input id="priceVat" type="number" inputmode="numeric" min="0" step="1" placeholder="–ù–∞–ø—Ä.: 330000">
        </div>

        <div class="field">
            <label for="priceNoVat">–¶—ñ–Ω–∞ –±–µ–∑ –ü–î–í (–≥—Ä–Ω)</label>
            <input id="priceNoVat" type="number" inputmode="numeric" min="0" step="1" placeholder="–ù–∞–ø—Ä.: 310000">
        </div>

        <div class="field">
            <label for="managerPhone">–¢–µ–ª–µ—Ñ–æ–Ω –º–µ–Ω–µ–¥–∂–µ—Ä–∞</label>
            <input id="managerPhone" type="tel" placeholder="+38 067 010 57 75" autocomplete="tel">
        </div>

        <div class="field">
            <label for="managerEmail">Email –º–µ–Ω–µ–¥–∂–µ—Ä–∞</label>
            <input id="managerEmail" type="email" placeholder="manager@email.com" autocomplete="email">
        </div>

        <div class="actions">
            <button class="btn" type="button" id="updatePreview">–û–Ω–æ–≤–∏—Ç–∏</button>
            <button class="btn btn-primary" type="button" id="generatePdf">–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ PDF</button>
        </div>
    </div>
    <div class="hint" id="status" aria-live="polite"></div>
</div>

<div class="page">
    <header>
        <div class="brand">
            <!-- –í–ê–® –õ–û–ì–û–¢–ò–ü –¢–£–¢ -->
            <!-- –ó–∞–º—ñ–Ω—ñ—Ç—å 'frame-85-1.png' –Ω–∞ —Ä–µ–∞–ª—å–Ω–∏–π —à–ª—è—Ö –¥–æ —Ñ–∞–π–ª—É, —è–∫—â–æ –≤—ñ–Ω –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è -->
            <img src="frame-85-1.png" alt="General Machines Logo" class="logo-placeholder" onerror="this.src='https://placehold.co/200x60/transparent/1A1A1A?text=GENERAL+MACHINES';">
            
            <div class="company-details">
                –¢–û–í ¬´–ê–ì–†–û–ö–£–ë¬ª | –ö–æ–¥ –Ñ–î–†–ü–û–£: 41408616<br>
                –ó–∞–ø–æ—Ä—ñ–∑—å–∫–∞ –æ–±–ª., –≤—É–ª. –õ–µ—Å—ñ –£–∫—Ä–∞—ó–Ω–∫–∏, 45/112
            </div>
        </div>
        <div class="meta-info">
            <div class="date" id="docDate">19 –õ–∏—Å—Ç–æ–ø–∞–¥–∞ 2025</div>
            <div style="font-size: 14px; margin-top: 5px;">
                <a id="managerPhoneLink" href="tel:+380670105775" style="color:var(--text-main); text-decoration:none;">+38 067 010 57 75</a><br>
                general-machines.ua
            </div>
        </div>
    </header>

    <section class="hero">
        <span class="client-name" id="docClient">–®–∞–Ω–æ–≤–Ω–∏–π –û–ª–µ–≥ –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á</span>
        <h1>–†—ñ—à–µ–Ω–Ω—è –¥–ª—è —ñ–¥–µ–∞–ª—å–Ω–æ—ó<br><span class="highlight">–ø–µ—Ä–µ–¥–ø–æ—Å—ñ–≤–Ω–æ—ó –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏</span></h1>
        <p class="sub-hero" id="docSubHero">–ö—É–ª—å—Ç–∏–≤–∞—Ç–æ—Ä –ö–ü–° 4.0 ‚Äî –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å 4 –≥–∞/–≥–æ–¥, –æ–¥–∏–Ω –ø—Ä–æ—Ö—ñ–¥, –±–µ–∑ –∑–∞–±–∏–≤–∞–Ω–Ω—è.</p>
    </section>

    <!-- PROBLEMS & SOLUTIONS -->
    <div class="section-title">–ü–µ—Ä–µ–≤–∞–≥–∏ –≤ —Ä–æ–±–æ—Ç—ñ</div>
    <div class="features-grid">
        <div class="feature-item">
            <h3>üö´ –ë–µ–∑ –∑–∞–±–∏–≤–∞–Ω–Ω—è</h3>
            <p>–ö–æ–ª–µ—Å–∞ –≤–∏–Ω–µ—Å–µ–Ω—ñ –∑–∞ —Ä–∞–º—É. –ê–≥—Ä–µ–≥–∞—Ç –ø—Ä–∞—Ü—é—î –±–µ–∑ –ø–∞—É–∑ –Ω–∞–≤—ñ—Ç—å –Ω–∞ –∑–∞—Ä–æ—Å–ª–∏—Ö –¥—ñ–ª—è–Ω–∫–∞—Ö, —Ä–æ—Å–ª–∏–Ω–Ω—ñ —Ä–µ—à—Ç–∫–∏ –Ω–µ –Ω–∞–ª–∏–ø–∞—é—Ç—å.</p>
        </div>
        <div class="feature-item">
            <h3>üöú –í–∏—Å–æ–∫–∞ –ø—Ä–æ—Ö—ñ–¥–Ω—ñ—Å—Ç—å</h3>
            <p>–ü—Ä–∞—Ü—é—î –≤ –æ–¥–∏–Ω –ø—Ä–æ—Ö—ñ–¥ –Ω–∞–≤—ñ—Ç—å –Ω–∞ –≤–∞–∂–∫–∏—Ö “ë—Ä—É–Ω—Ç–∞—Ö. –ï–∫–æ–Ω–æ–º—ñ—è –ø–∞–ª—å–Ω–æ–≥–æ —Ç–∞ –∑–Ω–∏–∂–µ–Ω–Ω—è –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –Ω–∞ —Ç—Ä–∞–∫—Ç–æ—Ä.</p>
        </div>
        <div class="feature-item">
            <h3>üìè –Ü–¥–µ–∞–ª—å–Ω–∞ –ø—ñ–¥–æ—à–≤–∞</h3>
            <p>–ö–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –∑–∞–±–µ–∑–ø–µ—á—É—î —Ç–æ—á–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è “ë—Ä—É–Ω—Ç—É –±–µ–∑ —Ö–≤–∏–ª—å —ñ –ø—Ä–æ–≤–∞–ª—ñ–≤ –¥–ª—è —è–∫—ñ—Å–Ω–æ–≥–æ –ø–æ—Å—ñ–≤—É.</p>
        </div>
        <div class="feature-item">
            <h3>üîß –®–≤–∏–¥–∫–∏–π —Å–µ—Ä–≤—ñ—Å</h3>
            <p>–í—Å—ñ –æ—Å–Ω–æ–≤–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ –∑–Ω—ñ–º–Ω—ñ, –æ–ø–æ—Ä–Ω—ñ –∫–æ–ª–µ—Å–∞ –≤–∑–∞—î–º–æ–∑–∞–º—ñ–Ω–Ω—ñ. –ú—ñ–Ω—ñ–º—É–º –ø—Ä–æ—Å—Ç–æ—ó–≤ —É —Å–µ–∑–æ–Ω.</p>
        </div>
    </div>

    <!-- TECH SPECS -->
    <div class="section-title">–¢–µ—Ö–Ω—ñ—á–Ω—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</div>
    <div class="specs-layout">
        <div class="specs-content">
            <ul class="minimal-list">
                <li><strong>–†–æ–±–æ—á—ñ –æ—Ä–≥–∞–Ω–∏:</strong> 18 —Å—Ç—ñ–π–æ–∫ —É 3 —Ä—è–¥–∏ (—à–∞—Ö–º–∞—Ç–Ω–∏–π –ø–æ—Ä—è–¥–æ–∫). –õ–∞–ø–∞ 280 –º–º –¥–ª—è –ø–æ–≤–Ω–æ–≥–æ –ø–µ—Ä–µ–∫—Ä–∏—Ç—Ç—è.</li>
                <li><strong>–°—Ç—ñ–π–∫–∏ –Ω–∞ –≤–∏–±—ñ—Ä:</strong> S-–ø–æ–¥—ñ–±–Ω—ñ (Bellota) –∞–±–æ DV-—Å—Ç—ñ–π–∫–∏ 30x30 (Bianchi).</li>
                <li><strong>–†–∞–º–∞:</strong> –ü—Ä–æ—Ñ—ñ–ª—å 80x80x5 –º–º. –í–∞–≥–∞ 1200 –∫–≥. –ú—ñ—Ü–Ω—ñ—Å—Ç—å —ñ –¥–æ–≤–≥–æ–≤—ñ—á–Ω—ñ—Å—Ç—å.</li>
                <li><strong>–ö–æ—Ç–∫–∏ (320 –º–º):</strong> –ë–µ–∑–æ—Å—å–æ–≤–∞ —Å–∏—Å—Ç–µ–º–∞ (anti-clog). –°–ø—ñ—Ä–∞–ª—å–Ω–∞ –ø–æ–ª–æ—Å–∞ –∞–±–æ —Ç—Ä—É–±–∞.</li>
                <li><strong>–í–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–æ:</strong> –ü–æ–≤–Ω–∏–π —Ü–∏–∫–ª (–ª–∞–∑–µ—Ä, –ø–ª–∞–∑–º–∞, –ß–ü–£). –Ü–º–ø–æ—Ä—Ç–Ω–∞ –≥—ñ–¥—Ä–∞–≤–ª—ñ–∫–∞.</li>
            </ul>
        </div>
        <div class="specs-image">
            <!-- –ú–Ü–°–¶–ï –î–õ–Ø –§–û–¢–û –ö–£–õ–¨–¢–ò–í–ê–¢–û–†–ê -->
            <img src="https://placehold.co/600x400/EEE/333?text=KPS+4.0+Cultivator" alt="–ö—É–ª—å—Ç–∏–≤–∞—Ç–æ—Ä –ö–ü–° 4.0">
        </div>
    </div>

    <!-- PRICING -->
    <div class="pricing-section">
        <div class="product-info">
            <div class="product-name" id="docProductName">–ö—É–ª—å—Ç–∏–≤–∞—Ç–æ—Ä –ö–ü–° 4.0</div>
            <div style="font-size: 13px; color: var(--text-secondary);" id="docProductConfig">–ü–æ–≤–Ω–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—è –ø—ñ–¥ –ú–¢–ó 1025</div>
        </div>
        <div class="price-block">
            <span class="price-label">–¶—ñ–Ω–∞ –∑ –ü–î–í</span>
            <span class="price-value" id="docPriceVat">330 000 –≥—Ä–Ω</span>
            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 2px;" id="docPriceNoVat">310 000 –≥—Ä–Ω –±–µ–∑ –ü–î–í</div>
        </div>
    </div>

    <!-- TERMS -->
    <div class="terms-grid">
        <div class="term-item">
            <strong>–¢–µ—Ä–º—ñ–Ω–∏</strong>
            <span>–î–æ 14 –¥–Ω—ñ–≤</span>
        </div>
        <div class="term-item">
            <strong>–û–ø–ª–∞—Ç–∞</strong>
            <span>–ë—É–¥—å-—è–∫–∞ —Ñ–æ—Ä–º–∞</span>
        </div>
        <div class="term-item">
            <strong>–ö–æ–º–ø–µ–Ω—Å–∞—Ü—ñ—è</strong>
            <span>–î–µ—Ä–∂–∞–≤–Ω–∞ 25%</span>
        </div>
        <div class="term-item">
            <strong>–ì–∞—Ä–∞–Ω—Ç—ñ—è</strong>
            <span>12 –º—ñ—Å—è—Ü—ñ–≤</span>
        </div>
    </div>

    <footer>
        <p><span id="docManagerEmail">agrokube.manager4@gmail.com</span> &nbsp;|&nbsp; <a href="#">general-machines.ua</a></p>
    </footer>
</div>

<!-- PDF generation deps (render DOM to image to keep Cyrillic/fonts) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
    // –ö–∞—Ç–∞–ª–æ–≥ –∞–≥—Ä–µ–≥–∞—Ç—ñ–≤ (–≤–∑—è—Ç–æ –∑ –ø—Ä–∞–π—Å—É calc.html). –ü—ñ—Å–ª—è –≤–∏–±–æ—Ä—É ‚Äî –Ω–∞–∑–≤—É/—Ü—ñ–Ω—É –º–æ–∂–Ω–∞ –∑–º—ñ–Ω–∏—Ç–∏.
    // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ price1 (–±–µ–∑ –ü–î–í) / price2 (–∑ –ü–î–í), —è–∫ —É –ø—Ä–∞–π—Å—ñ.
    const catalogData = [
        {
            category: "–ö—É–Ω–∏",
            items: [
                { name: "GENERAL-X (–±–µ–∑ –∫–æ–≤—à–∞)", price1: 165000, price2: 190000 },
                { name: "GENERAL-X (–∑ –∫–æ–≤—à–µ–º –≤ –∫–æ–º–ø–ª–µ–∫—Ç—ñ)", price1: 185000, price2: 210000 },
                { name: "GENERAL-XL (–±–µ–∑ –∫–æ–≤—à–∞)", price1: 185000, price2: 210000 },
                { name: "GENERAL-XL (–∑ –∫–æ–≤—à–µ–º –≤ –∫–æ–º–ø–ª–µ–∫—Ç—ñ)", price1: 205000, price2: 230000 },
                { name: "GENERAL-EURO (–±–µ–∑ –∫–æ–≤—à–∞)", price1: 185000, price2: 210000 },
                { name: "GENERAL-EURO (–∑ –∫–æ–≤—à–µ–º –∫–æ–º–ø–ª–µ–∫—Ç—ñ)", price1: 205000, price2: 230000 },
                { name: "–î–∂–æ–π—Å—Ç–∏–∫ 2–†-40", price1: 10000, price2: 12000 },
                { name: "–î–∂–æ–π—Å—Ç–∏–∫ 2–†-80", price1: 15000, price2: 17000 },
                { name: "–ö–æ–º–ø–ª–µ–∫—Ç —Ç—Ä–µ—Ç—å–æ—ó —Å–µ–∫—Ü—ñ—ó", price1: 5000, price2: 6000 }
            ]
        },
        {
            category: "–ù–∞–≤—ñ—Å–Ω–µ –¥–æ –∫—É–Ω—ñ–≤",
            items: [
                { name: "–ö—ñ–≤—à STANDART 2 –º. 1.1 –∫—É–±", price1: 30000, price2: 35000 },
                { name: "–ö—ñ–≤—à STANDART 2.2–º 1.3 –∫—É–±.", price1: 32000, price2: 37000 },
                { name: "–ö—ñ–≤—à –∑–±—ñ–ª—å—à–µ–Ω–∏–π 2.4 –º –Ω–∞ 1.5 –∫—É–±", price1: 335000, price2: 40000 },
                { name: "–ö—ñ–≤—à –±—É–¥—ñ–≤–µ–ª—å–Ω–∏–π 1.6 –º.", price1: 30000, price2: 35000 },
                { name: "–ö—ñ–≤—à –©–ï–õ–ï–ü–ù–ò–ô 1.8 –º.", price1: 60000, price2: 70000 },
                { name: "–ö—ñ–≤—à –©–ï–õ–ï–ü–ù–ò–ô 2 –º.", price1: 65000, price2: 75000 },
                { name: "–ö—ñ–≤—à —ñ–∑ –ó–ê–•–û–ü–õ–ï–ù–ù–Ø–ú", price1: 65000, price2: 75000 },
                { name: "–ö—ñ–≤—à –¥–ª—è –ë–ï–ì–Ü–í", price1: 95000, price2: 105000 },
                { name: "–ö—ñ–≤—à –¥–ª—è –ë–ï–ì–Ü–í (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π)", price1: 100000, price2: 110000 },
                { name: "–ì–∞–∫ –¥–ª—è –±–µ–≥—ñ–≤", price1: 25000, price2: 30000 },
                { name: "–í–∏–ª–∞ –¥–ª—è –ø—ñ–¥–¥–æ–Ω—ñ–≤", price1: 25000, price2: 30000 },
                { name: "–í–∏–ª–∞ –¥–ª—è –¢–Æ–ö–Ü–í", price1: 25000, price2: 30000 },
                { name: "–í–∏–ª–∞ - –ì–∞–∫ (3 –≤ 1)", price1: 35000, price2: 40000 },
                { name: "–í–∏–ª–∞ - –ì–∞–∫ (2 –≤ 1)", price1: 33000, price2: 36000 },
                { name: "–í–∏–ª–∞ —Å—ñ–Ω–∞–∂–Ω—ñ", price1: 60000, price2: 70000 },
                { name: "–ó–∞—Ö–≤–∞—Ç –¥–ª—è –¢–Æ–ö–Ü–í", price1: 60000, price2: 70000 },
                { name: "–ó–∞—Ö–≤–∞—Ç –¥–ª—è –ö–û–õ–û–î", price1: 40000, price2: 45000 },
                { name: "–ö–æ—Ä—á—É–≤–∞—á", price1: 55000, price2: 66000 }
            ]
        },
        {
            category: "–ö—É–ª—å—Ç–∏–≤–∞—Ç–æ—Ä–∏",
            items: [
                { name: "–ö—É–ª—å—Ç–∏–≤–∞—Ç–æ—Ä –Ω–∞–≤—ñ—Å–Ω–∏–π –ö–ù–° 2.6", price1: 150000, price2: 165000 },
                { name: "–ö—É–ª—å—Ç–∏–≤–∞—Ç–æ—Ä –Ω–∞–≤—ñ—Å–Ω–∏–π –ö–ù–° 3.0", price1: 165000, price2: 180000 },
                { name: "–ö—É–ª—å—Ç–∏–≤–∞—Ç–æ—Ä –Ω–∞–≤—ñ—Å–Ω–∏–π –ö–ù–° 3.5", price1: 175000, price2: 190000 },
                { name: "–ö—É–ª—å—Ç–∏–≤–∞—Ç–æ—Ä –Ω–∞–≤—ñ—Å–Ω–∏–π –ö–ù–° 4.0", price1: 185000, price2: 200000 },
                { name: "–ü—Ä–∏—á—ñ–ø–Ω–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π –¥–æ –ö–ù–° 4.0", price1: 125000, price2: 130000 },
                { name: "–ë–ü–ü –±–∞–ª–∫–∞ –ø—Ä–∏—á—ñ–ø–Ω–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é", price1: 20000, price2: 23000 },
                { name: "–ö—É–ª—å—Ç–∏–≤–∞—Ç–æ—Ä –ø—Ä–∏—á—ñ–ø–Ω–∏–π –ö–ü–° 4.0", price1: 310000, price2: 330000 },
                { name: "–ö—É–ª—å—Ç–∏–≤–∞—Ç–æ—Ä –ø—Ä–∏—á—ñ–ø–Ω–∏–π –ö–ü–†–° 5.0", price1: 430000, price2: 480000 },
                { name: "–ö—É–ª—å—Ç–∏–≤–∞—Ç–æ—Ä –ø—Ä–∏—á—ñ–ø–Ω–∏–π –ö–ü–†–° 6.0", price1: 530000, price2: 580000 }
            ]
        },
        {
            category: "–õ—É—â–∏–ª—å–Ω–∏–∫–∏",
            items: [
                { name: "–õ—É—â–∏–ª—å–Ω–∏–∫ 2.6 –º.", price1: 260000, price2: 270000 },
                { name: "–õ—É—â–∏–ª—å–Ω–∏–∫ 2.6 –º. –∑ —Ç–∞–Ω–¥–µ–º–Ω–∏–º –∫–æ—Ç–∫–æ–º", price1: 300000, price2: 310000 },
                { name: "–õ—É—â–∏–ª—å–Ω–∏–∫ 2.6 –º. (–ø—Ä–∏—á—ñ–ø–Ω–∏–π)", price1: 420000, price2: 435000 },
                { name: "–õ—É—â–∏–ª—å–Ω–∏–∫ 3.2 –º.", price1: 350000, price2: 360000 },
                { name: "–õ—É—â–∏–ª—å–Ω–∏–∫ 3.2 –º. –∑ —Ç–∞–Ω–¥–µ–º–Ω–∏–º –∫–æ—Ç–∫–æ–º", price1: 415000, price2: 425000 },
                { name: "–õ—É—â–∏–ª—å–Ω–∏–∫ 3.2 –º. (–ø—Ä–∏—á—ñ–ø–Ω–∏–π)", price1: 530000, price2: 550000 },
                { name: "–õ—É—â–∏–ª—å–Ω–∏–∫ 4.2 –º. (–ø—Ä–∏—á—ñ–ø–Ω–∏–π)", price1: 750000, price2: 780000 },
                { name: "–õ—É—â–∏–ª—å–Ω–∏–∫ 5.2 –º. (–ø—Ä–∏—á—ñ–ø–Ω–∏–π)", price1: 910000, price2: 960000 },
                { name: "–ü—Ä–∏—á—ñ–ø–Ω–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π –¥–æ –õ–ù –±–µ–∑ –∫–∞—Ç–∫—ñ–≤", price1: 130000, price2: 130000 },
                { name: "–ü—Ä–∏—á—ñ–ø–Ω–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π –¥–æ –õ–ù2.6 –∑ –ø–æ–¥–≤—ñ–π–Ω–∏–º–∏ –∫–∞—Ç–∫–∞–º–∏", price1: 190000, price2: 210000 },
                { name: "–ü—Ä–∏—á—ñ–ø–Ω–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π –¥–æ –õ–ù2.6 –∑ –æ–¥–∏–Ω–∞—Ä–Ω–∏–º–∏ –∫–∞—Ç–∫–∞–º–∏", price1: 165000, price2: 190000 },
                { name: "–ü—Ä–∏—á—ñ–ø–Ω–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π –¥–æ –õ–ù 3.2 –∑ –æ–¥–∏–Ω–∞—Ä–Ω–∏–º–∏ –∫–∞—Ç–∫–∞–º–∏", price1: 175000, price2: 200000 },
                { name: "–ü—Ä–∏—á—ñ–ø–Ω–∏–π –ø—Ä–∏—Å—Ç—Ä—ñ–π –¥–æ –õ–ù3.2 –∑ –ø–æ–¥–≤—ñ–π–Ω–∏–º–∏ –∫–∞—Ç–∫–∞–º–∏", price1: 215000, price2: 235000 },
                { name: "–¢–∞–Ω–¥–µ–º–Ω–∏–π (–ø–æ–¥–≤—ñ–π–Ω—ñ) –∫–æ—Ç–∫–∏ –Ω–∞ –õ–ù", price1: 65000, price2: 65000 },
                { name: "–¢–∞–Ω–¥–µ–º–Ω–∏–π –∫–æ—Ç–æ–∫ –∑–∞–º—ñ—Å—Ç—å –æ–¥–∏–Ω–∞—Ä–Ω–æ–≥–æ", price1: 40000, price2: 40000 }
            ]
        },
        {
            category: "–ë–æ—Ä–æ–Ω–∏ –ø—Ä—É–∂–∏–Ω–Ω—ñ",
            items: [
                { name: "–ë–æ—Ä–æ–Ω–∞ –ø—Ä—É–∂–∏–Ω–Ω–∞ 6 –º. (–±–µ–∑ –æ–ø–æ—Ä–Ω–∏—Ö –∫–æ–ª—ñ—Å)", price1: 130000, price2: 140000 },
                { name: "–ë–æ—Ä–æ–Ω–∞ –ø—Ä—É–∂–∏–Ω–Ω–∞ 6 –º –∑ –∫–æ–ª–µ—Å–∞–º–∏ (7-–∫–∞/10-–∫–∞)", price1: 130000, price2: 140000 },
                { name: "–ë–æ—Ä–æ–Ω–∞ –ø—Ä—É–∂–∏–Ω–Ω–∞ 9 –º. (–±–µ–∑ –æ–ø–æ—Ä–Ω–∏—Ö –∫–æ–ª—ñ—Å)", price1: 150000, price2: 160000 },
                { name: "–ë–æ—Ä–æ–Ω–∞ –ø—Ä—É–∂–∏–Ω–Ω–∞ 9 –º. + –æ–ø–æ—Ä–Ω—ñ –∫–æ–ª–µ—Å–∞", price1: 160000, price2: 175000 },
                { name: "–ö–æ–ª–µ—Å–∞ –æ–ø–æ—Ä–Ω—ñ", price1: 35000, price2: 40000 },
                { name: "–ö—Ä—ñ–ø–ª–µ–Ω–Ω—è \"—î–≤—Ä–æ–±–∞–ª–∫–∞\" –¥–æ –ø—Ä—É–∂–∏–Ω–Ω–æ—ó –±–æ—Ä–æ–Ω–∏", price1: 5500, price2: 7000 },
                { name: "–ö—Ä—ñ–ø–ª–µ–Ω–Ω—è \"—Ç—Ä—å–æ—Ö—Ç–æ—á–∫–∞\" –¥–æ –ø—Ä—É–∂–∏–Ω–Ω–æ—ó –±–æ—Ä–æ–Ω–∏", price1: 8000, price2: 10000 },
                { name: "–ö–æ–º–ø–ª–µ–∫—Ç –ø—Ä—É–∂–∏–Ω (7-–∫–∞/10–∫–∞)", price1: 40000, price2: 45000 },
                { name: "–ö–æ–º–ø–ª–µ–∫—Ç –ø—Ä—É–∂–∏–Ω –Ω–∞ —Ç—Ä—É–±—ñ (7-–∫–∞/10–∫–∞)", price1: 65000, price2: 75000 },
                { name: "–£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∞ –ø—Ä—É–∂–∏–Ω–Ω–∞ –±–æ—Ä–æ–Ω–∞ 9 –º", price1: 250000, price2: 270000 }
            ]
        },
        {
            category: "–ö–†–ù–∏",
            items: [
                { name: "–ö–†–ù 4.2 –Ω–∞–≤—ñ—Å–Ω–∏–π (–º—ñ–∂—Ä—è–¥–Ω–∏–π —Ä–æ–∑–∫–ª–∞–¥–Ω–∏–π)", price1: 290000, price2: 320000 },
                { name: "–ö–†–ù 5.6 –Ω–∞–≤—ñ—Å–Ω–∏–π –†–û–ó–ö–õ–ê–î–ù–ê —Ä–∞–º–∞ (–º—ñ–∂—Ä—è–¥–Ω–∏–π)", price1: 320000, price2: 360000 },
                { name: "–ö–†–ù 5.6 –Ω–∞–≤—ñ—Å–Ω–∏–π –°–£–¶–Ü–õ–¨–ù–ê —Ä–∞–º–∞ (–º—ñ–∂—Ä—è–¥–Ω–∏–π)", price1: 250000, price2: 280000 },
                { name: "–ö–†–ù 5.6 –Ω–∞–≤—ñ—Å–Ω–∏–π —Ä–æ–∑–∫–ª–∞–¥–Ω–∏–π –∑ –ë–û–ß–ö–û–Æ 500–ª (–ü—ñ–¥ –ú–¢–ó, –±–æ—á–∫–∞ —Å–ø–µ—Ä–µ–¥—É)", price1: 455000, price2: 510000 },
                { name: "–ö–†–ù 5.6 –Ω–∞–≤—ñ—Å–Ω–∏–π —Ä–æ–∑–∫–ª–∞–¥–Ω–∏–π –∑ –ë–û–ß–ö–û–Æ 500–ª (–±–æ—á–∫–∞ –Ω–∞ —Å–∞–º–æ–º—É –ö–†–ù)", price1: 420000, price2: 510000 },
                { name: "–ö–†–ù 5.6 –Ω–∞–≤—ñ—Å–Ω–∏–π —Å—É—Ü—ñ–ª—å–Ω–∞ —Ä–∞–º–∞ –∑ –ë–û–ß–ö–û–Æ 500–ª", price1: 360000, price2: 395000 },
                { name: "–ó–∞—Ö–∏—Å–Ω–∏–π —â–∏—Ç–æ–∫ —Ä—è–¥–∫–∞", price1: 31000, price2: 35000 },
                { name: "–ë–æ—á–∫–∞ –¥–ª—è —Ä—ñ–¥–∫–∏—Ö –¥–æ–±—Ä–∏–≤ –Ω–∞ –ö–†–ù –Ω–∞ —Ä–∞–º—É", price1: 130000, price2: 145000 },
                { name: "–ë–æ—á–∫–∞ –¥–ª—è —Ä—ñ–¥–∫–∏—Ö –¥–æ–±–Ω–∏–≤ –Ω–∞ –ö–†–ù —Ä–æ–∑–∫–ª–∞–¥–Ω–∏–π (–∑ –ø–µ—Ä–µ–¥—É —Ç—Ä–∞–∫—Ç–æ—Ä–∞)", price1: 145000, price2: 160000 }
            ]
        },
        {
            category: "–ì–ª–∏–±–æ–∫–æ—Ä–æ–∑–ø—É—à—É–≤–∞—á—ñ",
            items: [
                { name: "–ì–ª–∏–±–æ–∫–æ—Ä–æ–∑–ø—É—à—É–≤–∞—á 1.8 –º.", price1: 350000, price2: 370000 },
                { name: "–ì–ª–∏–±–æ–∫–æ—Ä–æ–∑–ø—É—à—É–≤–∞—á 2.5 –º.", price1: 400000, price2: 425000 },
                { name: "–ì–ª–∏–±–æ–∫–æ—Ä–æ–∑–ø—É—à—É–≤–∞—á 3 –º. 5 –ª–∞–ø", price1: 435000, price2: 450000 },
                { name: "–ì–ª–∏–±–æ–∫–æ—Ä–æ–∑–ø—É—à—É–≤–∞—á 3 –º. 7 –ª–∞–ø", price1: 490000, price2: 510000 }
            ]
        },
        {
            category: "–í—ñ–¥–≤–∞–ª–∏",
            items: [
                { name: "–ì—Ä–µ–π–¥–µ—Ä–Ω–∏–π –≤—ñ–¥–≤–∞–ª", price1: 60000, price2: 70000 },
                { name: "–í—ñ–¥–≤–∞–ª –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π (–î–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—ñ–π) –Ω–∞ –°–¢–†–Ü–õ–£", price1: 25000, price2: 60000 },
                { name: "–í—ñ–¥–≤–∞–ª –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π (–î–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—ñ–π)", price1: 50000, price2: 60000 },
                { name: "–í—ñ–¥–≤–∞–ª –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π (–î–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—ñ–π) –≥—ñ–¥—Ä–æ-–ø–æ–≤–æ—Ä–æ—Ç–Ω–∏–π", price1: 65000, price2: 75000 },
                { name: "–í—ñ–¥–≤–∞–ª –£–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–∏–π (–î–≤–æ—Å—Ç–æ—Ä–æ–Ω–Ω—ñ–π) –≥—ñ–¥—Ä–æ-–ø–æ–≤–æ—Ä–æ—Ç–Ω–∏–π EURO", price1: 70000, price2: 80000 },
                { name: "–í—ñ–¥–≤–∞–ª –¥–ª—è –±—É—Ä—Ç—É–≤–∞–Ω–Ω—è –∑–µ—Ä–Ω–∞", price1: 27000, price2: 35000 }
            ]
        },
        {
            category: "–ó—É–±–æ–≤—ñ –±–æ—Ä–æ–Ω–∏",
            items: [
                { name: "–ë–æ—Ä–æ–Ω–∞ –∑—É–±–æ–≤–∞ 9 –º. —Å–∫–ª–∞–¥–Ω–∞", price1: 390000, price2: 435000 }
            ]
        },
        {
            category: "–ö—Ä–∞–Ω–∏-–º–∞–Ω—ñ–ø—É–ª—è—Ç–æ—Ä–∏",
            items: [
                { name: "–ö—Ä–∞–Ω-–º–∞–Ω—ñ–ø—É–ª—è—Ç–æ—Ä S-1500", price1: 90000, price2: 100000 },
                { name: "–ö—Ä–∞–Ω-–º–∞–Ω—ñ–ø—É–ª—è—Ç–æ—Ä SL-2000", price1: 300000, price2: 340000 }
            ]
        },
        {
            category: "–ë–û–ß–ö–ê –ö–ê–° 8 –∫—É–±.",
            items: [
                { name: "–ë–æ—á–∫–∞ –¥–ª—è –≤–Ω–µ—Å–µ–Ω–Ω—è –¥–æ–±—Ä–∏–≤ 8 –∫—É–±.", price1: 480000, price2: 550000 }
            ]
        }
    ];

    function $(id) {
        return document.getElementById(id);
    }

    function formatUAH(amount) {
        const num = Number(amount);
        if (!Number.isFinite(num)) return '';
        return num.toLocaleString('uk-UA');
    }

    function normalizePhoneForTel(phone) {
        const raw = (phone || '').trim();
        if (!raw) return '';
        const plus = raw.startsWith('+') ? '+' : '';
        const digits = raw.replace(/[^0-9]/g, '');
        return plus ? `+${digits}` : digits;
    }

    function setStatus(text) {
        const el = $('status');
        if (el) el.textContent = text || '';
    }

    // --- Firebase: –ø—Ä–∞–π—Å –∑ –±–∞–∑–∏ (Firestore) ---
    // –ö–æ–ª–µ–∫—Ü—ñ—è: priceItems
    // –ü–æ–ª—è: { category, name, price1, price2, sortCategory?, sortItem?, active? }
    const FIREBASE_CONFIG = {
        apiKey: "AIzaSyCIDpmrCoITjCfqMeC94ZO7Enl4HyZ-Lkw",
        authDomain: "gm-base.firebaseapp.com",
        projectId: "gm-base",
        storageBucket: "gm-base.firebasestorage.app",
        messagingSenderId: "579626247182",
        appId: "1:579626247182:web:09324aa5823c564defc85f"
    };

    let firebasePriceApiPromise_ = null;

    async function initFirebaseForPrice_() {
        if (firebasePriceApiPromise_) return firebasePriceApiPromise_;
        firebasePriceApiPromise_ = (async () => {
            const appMod = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
            const fsMod = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
            const authMod = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');

            let app;
            const appName = 'price-kp';
            try {
                app = appMod.initializeApp(FIREBASE_CONFIG, appName);
            } catch (e) {
                app = appMod.getApp(appName);
            }

            const db = fsMod.getFirestore(app);

            try {
                const auth = authMod.getAuth(app);
                if (!auth.currentUser) {
                    await authMod.signInAnonymously(auth);
                    console.info('[kp] Firebase auth: anonymous signed in');
                }
            } catch (e) {
                console.warn('[kp] Firebase auth: anonymous sign-in failed', { code: e?.code, message: e?.message });
            }

            return { db, ...fsMod };
        })();
        return firebasePriceApiPromise_;
    }

    function buildCatalogFromPriceDocs_(docs) {
        const byCat = new Map();
        for (const d of docs) {
            const data = d.data ? d.data() : d;
            if (!data) continue;
            if (data.active === false) continue;
            const category = String(data.category || '').trim();
            const name = String(data.name || '').trim();
            const price1 = Number(data.price1);
            const price2 = Number(data.price2);
            if (!category || !name) continue;
            if (!Number.isFinite(price1) || !Number.isFinite(price2)) continue;

            const sortCategory = Number.isFinite(Number(data.sortCategory)) ? Number(data.sortCategory) : null;
            const sortItem = Number.isFinite(Number(data.sortItem)) ? Number(data.sortItem) : null;

            if (!byCat.has(category)) byCat.set(category, { category, sortCategory, items: [] });
            byCat.get(category).items.push({ name, price1, price2, sortItem });
        }

        const cats = Array.from(byCat.values());
        cats.sort((a, b) => {
            const as = a.sortCategory;
            const bs = b.sortCategory;
            if (as != null && bs != null && as !== bs) return as - bs;
            if (as != null && bs == null) return -1;
            if (as == null && bs != null) return 1;
            return String(a.category).localeCompare(String(b.category), 'uk');
        });

        for (const c of cats) {
            c.items.sort((a, b) => {
                const as = a.sortItem;
                const bs = b.sortItem;
                if (as != null && bs != null && as !== bs) return as - bs;
                if (as != null && bs == null) return -1;
                if (as == null && bs != null) return 1;
                return String(a.name).localeCompare(String(b.name), 'uk');
            });
            c.items = c.items.map(({ name, price1, price2 }) => ({ name, price1, price2 }));
            delete c.sortCategory;
        }
        return cats;
    }

    async function loadCatalogFromFirestore_() {
        try {
            const api = await initFirebaseForPrice_();
            const snap = await api.getDocs(api.collection(api.db, 'priceItems'));
            if (!snap || snap.empty) return false;

            const next = buildCatalogFromPriceDocs_(snap.docs);
            if (!next.length) return false;

            catalogData.length = 0;
            catalogData.push(...next);
            return true;
        } catch (e) {
            const code = e?.code;
            if (code === 'permission-denied' || /insufficient permissions/i.test(String(e?.message || ''))) {
                console.warn('[kp] price catalog load failed: permission denied. Fix Firestore Rules for /priceItems.', e);
            } else if (code === 'auth/unauthorized-domain') {
                console.warn('[kp] price catalog load failed: unauthorized domain. Add domain in Firebase Auth -> Settings -> Authorized domains.', e);
            } else {
                console.warn('[kp] price catalog load failed', e);
            }
            return false;
        }
    }

    function populateProductSelect() {
        const select = $('productSelect');
        if (!select) return;

        // clear previous groups, keep the first placeholder option
        while (select.options.length > 1) {
            select.remove(1);
        }

        for (const cat of catalogData) {
            const group = document.createElement('optgroup');
            group.label = cat.category;
            for (const item of cat.items) {
                const option = document.createElement('option');
                option.value = JSON.stringify(item);
                option.textContent = `${item.name} ‚Äî ${formatUAH(item.price2)} –≥—Ä–Ω (–∑ –ü–î–í)`;
                group.appendChild(option);
            }
            select.appendChild(group);
        }
    }

    function applySelectedProductToInputs() {
        const select = $('productSelect');
        const value = select?.value;
        if (!value) return;

        let item;
        try {
            item = JSON.parse(value);
        } catch {
            return;
        }

        $('productName').value = item.name || '';
        $('priceVat').value = Number.isFinite(Number(item.price2)) ? item.price2 : '';
        $('priceNoVat').value = Number.isFinite(Number(item.price1)) ? item.price1 : '';
    }

    function updatePreview() {
        const clientFullName = $('clientFullName').value.trim();
        const clientTractor = $('clientTractor').value.trim();
        const productName = $('productName').value.trim();
        const priceVat = $('priceVat').value;
        const priceNoVat = $('priceNoVat').value;
        const managerPhone = $('managerPhone').value.trim();
        const managerEmail = $('managerEmail').value.trim();

        const now = new Date();
        const dateText = now.toLocaleDateString('uk-UA', { day: '2-digit', month: 'long', year: 'numeric' });
        $('docDate').textContent = dateText;

        $('docClient').textContent = clientFullName ? `–®–∞–Ω–æ–≤–Ω–∏–π ${clientFullName}` : '–®–∞–Ω–æ–≤–Ω–∏–π(–∞)';

        // –ú—ñ–Ω—ñ–º–∞–ª—å–Ω–æ –æ–Ω–æ–≤–ª—é—î–º–æ –æ–ø–∏—Å, –±–µ–∑ –≤–∏–≥–∞–¥–∞–Ω–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
        if (productName) {
            $('docSubHero').textContent = clientTractor
                ? `${productName} ‚Äî –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—è –ø—ñ–¥ ${clientTractor}.`
                : `${productName} ‚Äî –∫–æ–º–µ—Ä—Ü—ñ–π–Ω–∞ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—è.`;
        }

        $('docProductName').textContent = productName || '–ê–≥—Ä–µ–≥–∞—Ç';
        $('docProductConfig').textContent = clientTractor ? `–ü–æ–≤–Ω–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—è –ø—ñ–¥ ${clientTractor}` : '–ü–æ–≤–Ω–∞ –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—è';

        const vatNum = Number(priceVat);
        const noVatNum = Number(priceNoVat);
        $('docPriceVat').textContent = Number.isFinite(vatNum) ? `${formatUAH(vatNum)} –≥—Ä–Ω` : '‚Äî –≥—Ä–Ω';
        $('docPriceNoVat').textContent = Number.isFinite(noVatNum) ? `${formatUAH(noVatNum)} –≥—Ä–Ω –±–µ–∑ –ü–î–í` : '‚Äî –≥—Ä–Ω –±–µ–∑ –ü–î–í';

        const tel = normalizePhoneForTel(managerPhone);
        if (tel) {
            $('managerPhoneLink').href = `tel:${tel}`;
            $('managerPhoneLink').textContent = managerPhone;
        }

        $('docManagerEmail').textContent = managerEmail || '‚Äî';
    }

    function validateRequired() {
        const required = [
            { id: 'clientFullName', label: '–ü–Ü–ë' },
            { id: 'clientTractor', label: '–¢—Ä–∞–∫—Ç–æ—Ä –∫–ª—ñ—î–Ω—Ç–∞' },
            { id: 'productName', label: '–ù–∞–∑–≤–∞ –∞–≥—Ä–µ–≥–∞—Ç—É' },
            { id: 'priceVat', label: '–¶—ñ–Ω–∞ –∑ –ü–î–í' },
            { id: 'priceNoVat', label: '–¶—ñ–Ω–∞ –±–µ–∑ –ü–î–í' },
            { id: 'managerPhone', label: '–¢–µ–ª–µ—Ñ–æ–Ω –º–µ–Ω–µ–¥–∂–µ—Ä–∞' },
            { id: 'managerEmail', label: 'Email –º–µ–Ω–µ–¥–∂–µ—Ä–∞' }
        ];

        const missing = [];
        for (const field of required) {
            const el = $(field.id);
            const value = (el?.value || '').toString().trim();
            if (!value) missing.push(field.label);
        }

        if (missing.length) {
            setStatus(`–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –ø–æ–ª—è: ${missing.join(', ')}`);
            return false;
        }

        setStatus('');
        return true;
    }

    async function generatePdf() {
        if (!validateRequired()) return;
        updatePreview();

        const pageEl = document.querySelector('.page');
        if (!pageEl) return;

        setStatus('–ì–µ–Ω–µ—Ä—É—é PDF‚Ä¶');

        const canvas = await html2canvas(pageEl, {
            scale: Math.min(2, window.devicePixelRatio || 2),
            useCORS: true,
            backgroundColor: '#FFFFFF'
        });

        const imgData = canvas.toDataURL('image/png');
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');

        const pageWidth = 210;
        const pageHeight = 297;
        const imgWidth = pageWidth;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;

        let heightLeft = imgHeight;
        let position = 0;

        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;

        while (heightLeft > 0) {
            position -= pageHeight;
            pdf.addPage();
            pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
        }

        const clientSafe = $('clientFullName').value.trim().replace(/[\\/:*?"<>|]/g, '').slice(0, 40) || 'client';
        const dateSafe = new Date().toISOString().slice(0, 10);
        pdf.save(`KP_${clientSafe}_${dateSafe}.pdf`);

        setStatus('PDF –≥–æ—Ç–æ–≤–∏–π.');
    }

    document.addEventListener('DOMContentLoaded', () => {
        // Try to load price list from Firestore, then populate.
        loadCatalogFromFirestore_().finally(() => {
            populateProductSelect();
        });

        $('productSelect').addEventListener('change', () => {
            applySelectedProductToInputs();
            updatePreview();
        });

        $('updatePreview').addEventListener('click', updatePreview);
        $('generatePdf').addEventListener('click', () => { generatePdf().catch(() => setStatus('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ PDF.')); });

        // –õ–µ–≥–∫–∞ –∞–≤—Ç–æ–ø—ñ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—ñ –ø–æ–ª—ñ–≤
        ['clientFullName','clientTractor','productName','priceVat','priceNoVat','managerPhone','managerEmail'].forEach(id => {
            const el = $(id);
            if (!el) return;
            el.addEventListener('input', () => {
                // –±–µ–∑ –∞–≥—Ä–µ—Å–∏–≤–Ω–æ–≥–æ –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä—É, –∞–ª–µ —Ç—Ä–∏–º–∞—î–º–æ –ø—Ä–µ–≤ º—é –∞–∫—Ç—É–∞–ª—å–Ω–∏–º
                updatePreview();
            });
        });

        updatePreview();
    });
</script>

</body>
</html>